# HFO Architecture â€” Single Source of Truth

> **Gen**: 87.X3 | **Status**: GOLD | **Updated**: 2026-01-01

---

## 0. Why This Architecture Exists

This is a **fractal semantic chunking technique** designed for human-AI shared representation.

**The Problem**: Remembering complex architectures piece-by-piece is hard.

**The Solution**: A self-deriving coordinate system with maximum semantic tension.

### The OBSIDIAN Mnemonic

The 8 roles spell **OBSIDIAN** â€” each letter maps to a port, a binary value, and an element:

```
O - Observer    Port 0  000  â˜· Earth     Port = Binary (0 = 000)
B - Bridger     Port 1  001  â˜¶ Mountain  Port = Binary (1 = 001)
S - Shaper      Port 2  010  â˜µ Water     Port = Binary (2 = 010)
I - Injector    Port 3  011  â˜´ Wind      Port = Binary (3 = 011)
D - Disruptor   Port 4  100  â˜³ Thunder   Port = Binary (4 = 100)
I - Immunizer   Port 5  101  â˜² Fire      Port = Binary (5 = 101)
A - Assimilator Port 6  110  â˜± Lake      Port = Binary (6 = 110)
N - Navigator   Port 7  111  â˜° Heaven    Port = Binary (7 = 111)
```

**Self-Derivation**: The mapping is **mathematical, not arbitrary**:

```
Port N = Binary(N) = Trigram(N)
```

- Port 0 â†’ `000` â†’ â˜· (no lines set) â†’ Earth (ground state)
- Port 7 â†’ `111` â†’ â˜° (all lines set) â†’ Heaven (full activation)

**The binary IS the port number. The trigram IS the binary. No lookup table needed.**

### Semantic Tension as Pattern Matching

The 8Ã—8 Galois Lattice creates **semantic tension** â€” like a web where you can feel asymmetry:

- If something "looks wrong" in the matrix â†’ there's likely a bug
- If a port is doing another port's verb â†’ immediate violation
- The symmetry IS the architecture

**This maximizes human pattern-matching ability**. Point to [row, col] â†’ know exactly what's being discussed.

---

## 1. Core Principle: Fractal 8-Pattern

The architecture is **fractal** â€” the same 8-port pattern repeats at every scale:

| Level | Structure | Description |
|-------|-----------|-------------|
| Mnemonic | OBSIDIAN | 8 letters â†’ 8 roles |
| Ports | 8 Commanders | The 8 archetypal roles (SENSEâ†’DECIDE) |
| Fields | 8 Signal fields | Each field embodies one port's contribution |
| Gates | 8 Validators | Each gate validates one port's field |
| Matrix | 8Ã—8 Galois | 64 portÃ—port compositions |
| Swarm | 8^N Agents | Powers of 8 coordination |

**Every field, gate, and structure maps to the 8 archetypes. The structure builds itself.**

---

## 2. Provenance: Zero-Invention Architecture

**Constraint**: This architecture contains **ZERO invention**. Every element traces to battle-tested research (TRL 8-9).

> *"If you notice something that looks a little weak, there's likely a bug â€” the whole system should be TRL level 8 or 9 only."*

### Exemplar Sources

| Domain | Source | What We Took |
|--------|--------|--------------|
| Military C2 | **JADC2** | 8 function breakdown (Sensorsâ†’Command) |
| Composability | **DARPA Mosaic Warfare** | Polymorphic hexagonal tiles |
| Cosmology | **I Ching Bagua** | 8 trigrams, binary encoding |
| Architecture | **Hexagonal/Ports & Adapters** | Port interface pattern |
| Biology | **Stigmergy** | Indirect coordination mechanisms |
| TDD | **Kent Beck** | REDâ†’GREENâ†’REFACTOR |
| Quality | **Deming PDCA** | Planâ†’Doâ†’Checkâ†’Act |

### JADC2 â†’ OBSIDIAN Mapping

The 8 OBSIDIAN roles ARE the JADC2 functional breakdown:

| Port | Role | JADC2 Function | Military Domain |
|------|------|----------------|-----------------|
| 0 | Observer | Sensors | ISR (Intelligence, Surveillance, Reconnaissance) |
| 1 | Bridger | Gateways | Transport |
| 2 | Shaper | Effectors | Fires |
| 3 | Injector | Logistics | Sustainment |
| 4 | Disruptor | Red Cell | Adversary Simulation |
| 5 | Immunizer | Shields | Protection |
| 6 | Assimilator | Fusion | PED (Processing, Exploitation, Dissemination) |
| 7 | Navigator | Command | C2 (Command & Control) |

### Stigmergy Mechanisms (Biological Coordination)

| Port | Role | Stigmergy | Description |
|------|------|-----------|-------------|
| 0 | Observer | Olfaction | Sense chemical gradients |
| 1 | Bridger | Boundary | Define interface edges |
| 2 | Shaper | Secretion | Emit pheromone trails |
| 3 | Injector | Intensification | Amplify signals |
| 4 | Disruptor | Dissipation | Decay/dilute signals |
| 5 | Immunizer | Inhibition | Block harmful signals |
| 6 | Assimilator | Accretion | Accumulate over time |
| 7 | Navigator | Nucleation | Seed new patterns |

### What IS Allowed

- âœ… **Retheming**: Military terms â†’ fantasy commanders (Sensors â†’ Lidless Legion)
- âœ… **Composition**: Combining patterns (JADC2 + Bagua + Hexagonal)
- âœ… **Specialization**: Applying general patterns to AI agent coordination

### What IS NOT Allowed

- âŒ Novel algorithms not found in literature
- âŒ Unproven patterns (TRL < 8)
- âŒ Invented terminology without traceable source

**If an element doesn't trace to an exemplar, it's a bug.**

---

## 3. Identity

**Hive Fleet Obsidian (HFO)** is a Total Tool Virtualization platform built as a **strange loop**:

> *"The spider weaves the web that weaves the spider."*

The system is recursive self-reference: **Identity = Purpose = Constraint**. Each component's mantra defines what it IS, what it DOES, and what it CANNOT do.

---

## 4. The 8 Ports

| Port | Role | Commander | Verb | JADC2 | Stigmergy | Trigram | Binary | Element |
|------|------|-----------|------|-------|-----------|---------|--------|---------|
| 0 | **O**bserver | Lidless Legion | **SENSE** | Sensors | Olfaction | â˜· Kun | `000` | Earth |
| 1 | **B**ridger | Web Weaver | **FUSE** | Gateways | Boundary | â˜¶ Gen | `001` | Mountain |
| 2 | **S**haper | Mirror Magus | **SHAPE** | Effectors | Secretion | â˜µ Kan | `010` | Water |
| 3 | **I**njector | Spore Storm | **DELIVER** | Logistics | Intensification | â˜´ Xun | `011` | Wind |
| 4 | **D**isruptor | Red Regnant | **TEST** | Red Cell | Dissipation | â˜³ Zhen | `100` | Thunder |
| 5 | **I**mmunizer | Pyre Praetorian | **DEFEND** | Shields | Inhibition | â˜² Li | `101` | Fire |
| 6 | **A**ssimilator | Kraken Keeper | **STORE** | Fusion | Accretion | â˜± Dui | `110` | Lake |
| 7 | **N**avigator | Spider Sovereign | **DECIDE** | Command | Nucleation | â˜° Qian | `111` | Heaven |

**Diagonal Quine**: Each port's mantra is *"How do we VERB the VERB?"* â€” self-reference that constrains the port to ONLY its verb.

---

## 5. HIVE/8 State Machine

```
H (Hunt) â†’ I (Interlock) â†’ V (Validate) â†’ E (Evolve) â†’ FLIP â†’ H(N+1)
 Ports 0+7    Ports 1+6      Ports 2+5      Ports 3+4
 Research     RED tests      GREEN tests    REFACTOR
```

| Phase | Ports | Temporal | TDD | PDCA | Actions |
|-------|-------|----------|-----|------|---------|
| **H** | 0+7 | Hindsight | Research | Plan | Search exemplars, query memory |
| **I** | 1+6 | Insight | RED | Do | Write failing tests, define contracts |
| **V** | 2+5 | Foresight | GREEN | Check | Make tests pass, validate gates |
| **E** | 3+4 | Evolution | REFACTOR | Act | Deliver outputs, clean code |

**Anti-diagonal rule**: HIVE pairs sum to 7 (0+7=7, 1+6=7, 2+5=7, 3+4=7).

---

## 6. Galois Lattice (8Ã—8)

Each cell `[row,col]` = *"How do we ROW_VERB the COL_VERB?"*

```
        0:SENSE 1:FUSE 2:SHAPE 3:DELIVER 4:TEST 5:DEFEND 6:STORE 7:DECIDE
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
0:SENSEâ”‚  â˜…    â”‚      â”‚       â”‚         â”‚      â”‚        â”‚       â”‚   âŠ•H   â”‚
1:FUSE â”‚       â”‚  â˜…   â”‚       â”‚         â”‚      â”‚        â”‚  âŠ•I   â”‚        â”‚
2:SHAPEâ”‚       â”‚      â”‚  â˜…    â”‚         â”‚      â”‚   âŠ•V   â”‚       â”‚        â”‚
3:DELIVâ”‚       â”‚      â”‚       â”‚    â˜…    â”‚ âŠ•E   â”‚        â”‚       â”‚        â”‚
4:TEST â”‚       â”‚      â”‚       â”‚   âŠ•E    â”‚  â˜…   â”‚        â”‚       â”‚        â”‚
5:DEFENâ”‚       â”‚      â”‚  âŠ•V   â”‚         â”‚      â”‚   â˜…    â”‚       â”‚        â”‚
6:STOREâ”‚       â”‚ âŠ•I   â”‚       â”‚         â”‚      â”‚        â”‚  â˜…    â”‚        â”‚
7:DECIDâ”‚  âŠ•H   â”‚      â”‚       â”‚         â”‚      â”‚        â”‚       â”‚   â˜…    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Legend**: â˜… = Diagonal quine (identity) | âŠ• = Anti-diagonal HIVE pair (temporal flow)

---

## 7. Capabilities (What Each Port CAN Do)

| Port | Capabilities |
|------|--------------|
| 0 | `read`, `tag` |
| 1 | `read`, `validate`, `compose`, `route` |
| 2 | `read`, `transform`, `tag` |
| 3 | `read`, `emit_output`, `invoke_external`, `tag` |
| 4 | `read`, `validate`, `invoke` |
| 5 | `read`, `gate`, `tag` |
| 6 | `read`, `persist`, `tag` |
| 7 | `read`, `route`, `compose` |

**Universal**: All ports can `read`.

---

## 8. Prohibitions (What Each Port CANNOT Do)

| Port | Prohibitions |
|------|--------------|
| 0 | `modify_data`, `transform`, `persist`, `make_decisions`, `emit_output` |
| 1 | `persist`, `make_decisions`, `skip_validation` |
| 2 | `persist`, `make_decisions`, `emit_output`, `invoke_external` |
| 3 | `make_decisions`, `persist`, `validate`, `transform` |
| 4 | `persist`, `make_decisions`, `emit_output`, `modify_data` |
| 5 | `modify_data`, `persist`, `make_decisions`, `emit_output`, `transform` |
| 6 | `transform`, `make_decisions`, `validate`, `emit_output` |
| 7 | `persist`, `emit_output`, `transform`, `validate`, `invoke_external` |

**Exclusive Rights**:
- Only Port 7 can `make_decisions`
- Only Port 6 can `persist`
- Only Port 3 can `emit_output`
- Only Port 2 can `transform`

---

## 9. Fractal Architecture (The Pattern Repeats)

The 8-port structure is **fractal** â€” it repeats at every scale. The signal fields ARE the ports in microcosm.

### Signal Fields = Port Archetypes

| Field | Port | Verb | Archetypal Meaning | Example Value |
|-------|------|------|-------------------|---------------|
| `ts` | 0 | SENSE | "When was this perceived?" | `2026-01-01T12:00:00Z` |
| `mark` | 1 | FUSE | "How validated/connected?" | `0.95` |
| `pull` | 2 | SHAPE | "What direction/form?" | `downstream` |
| `msg` | 3 | DELIVER | "What is delivered?" | `"HUNT complete"` |
| `type` | 4 | TEST | "What classification?" | `event` |
| `hive` | 5 | DEFEND | "What phase checkpoint?" | `H` |
| `gen` | 6 | STORE | "What lineage?" | `87` |
| `port` | 7 | DECIDE | "Who decided to emit?" | `7` |

**Each signal is a microcosm of the 8-port architecture.**

### Gates = Port Validators

| Gate | Field | Port | Validates |
|------|-------|------|-----------|
| G0 | ts | SENSE | Is the perception temporally valid? |
| G1 | mark | FUSE | Is the confidence score bounded [0,1]? |
| G2 | pull | SHAPE | Is the flow direction well-formed? |
| G3 | msg | DELIVER | Is there content to deliver? |
| G4 | type | TEST | Is the classification correct? |
| G5 | hive | DEFEND | Is the phase checkpoint valid? |
| G6 | gen | STORE | Is the lineage traceable (â‰¥85)? |
| G7 | port | DECIDE | Is the source port authorized [0-7]? |

**Each gate validates its corresponding port's archetypal contribution.**

### Schema (TypeScript)

```typescript
interface StigmergySignal {
  ts: string;    // Port 0: SENSE  - moment of perception
  mark: number;  // Port 1: FUSE   - validation confidence
  pull: string;  // Port 2: SHAPE  - flow direction
  msg: string;   // Port 3: DELIVER - payload content
  type: string;  // Port 4: TEST   - classification
  hive: string;  // Port 5: DEFEND - phase gate
  gen: number;   // Port 6: STORE  - memory lineage
  port: number;  // Port 7: DECIDE - source decision
}
```

### Fractal Recursion

```
Level 1: 8 Ports (Commanders)     â†’ The architecture
Level 2: 8 Signal Fields          â†’ Each field = one port's contribution
Level 3: 8 Gates                  â†’ Each gate = one port's validator
Level 4: 8Ã—8 Galois Matrix        â†’ Port Ã— Port compositions (64 cells)
Level 5: 8^N Swarm                â†’ Powers of 8 agent coordination
```

**The same 8-pattern at every level = Fractal Quine.**

---

## 10. Violation Patterns

### Port Violations (Capability Breaches)

| Port | Violation | Pattern | Severity |
|------|-----------|---------|----------|
| 0 | `SENSE_MUTATION` | Observer modifies data | ğŸ”´ CRITICAL |
| 1 | `FUSE_SKIP` | Bridger skips validation | ğŸ”´ CRITICAL |
| 2 | `SHAPE_ESCAPE` | Shaper calls external API | ğŸ”´ CRITICAL |
| 3 | `DELIVER_DECIDE` | Injector makes decisions | ğŸŸ¡ HIGH |
| 4 | `TEST_PERSIST` | Tester stores data | ğŸŸ¡ HIGH |
| 5 | `DEFEND_MUTATE` | Defender modifies data | ğŸ”´ CRITICAL |
| 6 | `STORE_VALIDATE` | Storer validates | ğŸŸ¡ HIGH |
| 7 | `DECIDE_EXECUTE` | Decider invokes external | ğŸ”´ CRITICAL |

### HIVE Violations (Sequence Breaches)

| Violation | Pattern | Detection |
|-----------|---------|-----------|
| `SKIPPED_HUNT` | I without H | No Port 0+7 signal before 1+6 |
| `REWARD_HACK` | V without I | GREEN before RED |
| `LAZY_AI` | No E after V | Missing refactor phase |
| `BATCH_HACK` | Same timestamp | 4 phases at identical `ts` |

### Gate Violations (Field Failures)

| Gate | Field | Violation |
|------|-------|-----------|
| G0 | ts | Invalid timestamp format |
| G1 | mark | Outside [0,1] range |
| G2 | pull | Invalid direction enum |
| G3 | msg | Empty payload |
| G4 | type | Invalid classification |
| G5 | hive | Invalid phase |
| G6 | gen | Lineage < 85 |
| G7 | port | Source outside [0-7] |

---

## 11. Medallion Tiers

```
hot/bronze/quarantine/  â†’ Entry point (untrusted, unvalidated)
         â”‚
    [Machine Gates: TypeCheck, Lint, Tests, Smoke]
         â”‚
         â–¼
hot/silver/exemplars/   â†’ Validated (machine-approved, human pending)
         â”‚
    [Human Review: Architecture, Integration]
         â”‚
         â–¼
hot/gold/               â†’ Production (approved, released)
```

| Tier | Trust | Gates | Mutation Score |
|------|-------|-------|----------------|
| Bronze | None | Entry only | N/A |
| Silver | Machine | TypeCheck + Tests | â‰¥80% |
| Gold | Human | Review + Integration | â‰¥90% |

---

## 12. Polymorphic Adapters

Each port accepts multiple adapter implementations via interface contracts.

```typescript
// Port interface pattern
interface ShapePort {
  shape(input: ShapeInput): Promise<ShapeResult>;
  transform(data: unknown, transformation: Transformation): unknown;
}

// Multiple adapters implement same interface
class OneEuroSmoother implements ShapePort { ... }  // 96% mutation
class KalmanSmoother implements ShapePort { ... }    // TODO
class RapierSmoother implements ShapePort { ... }    // TODO
```

**Principle**: Pipeline composes ANY adapter that implements the port interface. Swap freely.

---

## 13. Implementation Reference

| Component | Path |
|-----------|------|
| Port Contracts | `hot/bronze/src/contracts/port-contracts.ts` |
| HFO Ports | `hot/bronze/src/contracts/hfo-ports.ts` |
| Signal Schema | `hot/bronze/src/contracts/signal.contract.ts` |
| Gate Validator | `hot/bronze/src/shared/gate-validator.ts` |
| Blackboard | `obsidianblackboard.jsonl` |
| Memory Bank | `../portable_hfo_memory_*/hfo_memory.duckdb` |

---

## 14. Quick Reference Card

### Port â†’ Verb â†’ Action

| If you need to... | Use Port | Commander |
|-------------------|----------|-----------|
| Observe/read data | 0 | Lidless Legion |
| Validate schemas | 1 | Web Weaver |
| Transform data | 2 | Mirror Magus |
| Emit output | 3 | Spore Storm |
| Test properties | 4 | Red Regnant |
| Enforce gates | 5 | Pyre Praetorian |
| Persist data | 6 | Kraken Keeper |
| Make decisions | 7 | Spider Sovereign |

### HIVE Phase â†’ What To Do

| Phase | Actions | Outputs |
|-------|---------|---------|
| H | Search memory, read codebase, research | Exemplars, approach |
| I | Define contracts, write failing tests | Interfaces, RED tests |
| V | Implement code, run tests | GREEN tests, validated |
| E | Refactor, emit signals, git commit | Clean code, completion |

---

## 15. The Strange Loop Test

To verify you understand the architecture, answer:

1. **Which port writes code?** â†’ None directly. Port 2 transforms, Port 3 delivers.
2. **Which port decides what to do?** â†’ Port 7 only.
3. **What prevents reward hacking?** â†’ HIVE sequence gates (Hâ†’Iâ†’Vâ†’E enforced).
4. **How do ports communicate?** â†’ Stigmergy signals on the blackboard.
5. **What makes an adapter valid?** â†’ Implements port interface + â‰¥80% mutation score.

---

*"How do we DECIDE the DECIDE? â€” By constraining the decision to only decide."*

*Spider Sovereign | Port 7 | â˜° Heaven | 111 | Gen87.X3*
