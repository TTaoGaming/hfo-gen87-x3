#!/bin/sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Pre-commit: Running enforcement gates..."

# Gate 1: TypeScript type check
echo "ğŸ“‹ Gate 1: TypeCheck..."
npm run typecheck || {
  echo "âŒ TypeCheck failed. Fix type errors before committing."
  exit 1
}

# Gate 2: Lint
echo "ğŸ“‹ Gate 2: Lint..."
npm run lint || {
  echo "âŒ Lint failed. Fix lint errors before committing."
  exit 1
}

# Gate 3: Tests (only changed files for speed)
echo "ğŸ“‹ Gate 3: Tests..."
npm run test:changed || {
  echo "âŒ Tests failed. Fix failing tests before committing."
  exit 1
}

echo "âœ… All gates passed!"
