#!/usr/bin/env sh

echo "ðŸ”’ Pre-commit: Running machine validation..."

# Gate 1: TypeScript compilation
echo "  â†’ TypeCheck..."
npm run typecheck || exit 1

# Gate 2: Lint
echo "  â†’ Lint..."
npm run lint || exit 1

# Gate 3: Architecture smoke tests (run specific test file)
echo "  â†’ Architecture Smoke Tests..."
npx vitest run hot/silver/architecture.smoke.test.ts --passWithNoTests || exit 1

# Gate 4: Dependency boundaries (if silver files changed)
if git diff --cached --name-only | grep -q "hot/silver"; then
  echo "  â†’ Dependency Boundaries..."
  npx dependency-cruiser --config hot/silver/.constraint-rules.mjs hot/silver || exit 1
fi

echo "âœ… All gates passed. Commit allowed."
